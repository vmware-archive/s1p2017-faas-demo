<!DOCTYPE html>
<meta charset="utf-8">

<div id="mousebox" style="display:inline-block; width:100%; height:100px; background-color:#ffa; border:1px solid #777;"></div>
<br>x = <span id="x">?</span>
<br>y = <span id="y">?</span>
<br>redis x = <span id="redis-x">?</span>
<br>redis y = <span id="redis-y">?</span>
<br>scale = <span id="redis-scale">?</span>
<br><span id="testfn" style="color:#35b; text-decoration:underline; cursor:pointer;">test scale</span> 

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io()
socket.on('connect', () => { console.log('connect', socket.id) })
socket.on('echoevent', (evt) => { 
  el('x').innerHTML = evt.x
  el('y').innerHTML = evt.y    
})
socket.on('demo:x', (x) => { el('redis-x').innerHTML = x })
socket.on('demo:y', (y) => { el('redis-y').innerHTML = y })
socket.on('demo:fns', (fns) => { el('redis-scale').innerHTML = JSON.stringify(fns) })

on(window, 'beforeunload', () => {
  console.log('disconnect', socket.id)
  socket.disconnect()
})

const testobj = {"testfn":0};
on(el('testfn'), 'click', (evt)  => {
  fetch('/', { 
    method: 'POST',
    body: JSON.stringify(testobj)
  })
  testobj.testfn++
})

on(el('mousebox'), 'mousemove', (evt) => {
  socket.emit('mouseevent', { x:evt.offsetX, y:evt.offsetY })
}) 

function el(id) { return document.getElementById(id); }
function on(el,evt,fn) { return el.addEventListener(evt, fn); }
</script>